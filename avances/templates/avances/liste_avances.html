{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
  <!-- Titre de la page -->
  <h2>Liste des avances</h2>

  <!-- ================= BOUTON AJOUTER ================= -->
  <!-- Bouton pour créer une nouvelle avance -->
  <div class="mb-3">
    <a href="{% url 'avances:add_avance' %}" class="btn btn-success">Ajouter une avance</a>
  </div>
  <!-- ================= FIN BOUTON AJOUTER ================= -->

  <!-- ================= FORMULAIRE DE RECHERCHE ================= -->
  <form method="get" class="mb-3 row g-3">
    <!-- Sélecteur pour choisir le type de recherche -->
    <div class="col-auto">
      {{ form.search_type.label_tag }} {{ form.search_type }}
    </div>

    <!-- Champ pour la recherche par date -->
    <div class="col-auto" id="date-field">
      {{ form.date.label_tag }} {{ form.date }}
    </div>

    <!-- Champ pour la recherche par mois -->
    <div class="col-auto" id="month-field">
      {{ form.month.label_tag }} {{ form.month }}
    </div>

    <!-- Champ pour filtrer par personnel -->
    <div class="col-auto">
      {{ form.personnel.label_tag }} {{ form.personnel }}
    </div>

    <!-- Boutons de validation et réinitialisation -->
    <div class="col-auto">
      <button type="submit" class="btn btn-primary">Rechercher</button>
      <a href="{% url 'avances:liste_avances' %}" class="btn btn-secondary">Réinitialiser</a>
    </div>
  </form>
  <!-- ================= FIN FORMULAIRE ================= -->

  <!-- ================= TABLEAU DES AVANCES ================= -->
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Date</th>
        <th>Montant</th>
        <th>Pris par</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for avance in avances %}
        <tr>
          <!-- Affichage de la date de l'avance -->
          <td>{{ avance.date_avance|date:"d/m/Y" }}</td>
          <!-- Montant de l'avance -->
          <td>{{ avance.montant }}</td>
          <!-- Personne ayant pris l'avance -->
          <td>{{ avance.personnel }}</td>
          <!-- Actions : éditer et supprimer -->
          <td>
            <a href="{% url 'avances:edit_avance' avance.pk %}" class="btn btn-sm btn-warning">Éditer</a>
            <a href="{% url 'avances:delete_avance' avance.pk %}" class="btn btn-sm btn-danger">Supprimer</a>
          </td>
        </tr>
      {% empty %}
        <!-- Message si aucune avance trouvée -->
        <tr>
          <td colspan="4">Aucune avance trouvée.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  <!-- ================= FIN TABLEAU ================= -->
</div>

<!-- ================= SCRIPT JAVASCRIPT ================= -->
<script>
  // Afficher/masquer les champs date/mois selon le select
  function toggleFields() {
    let type = document.querySelector("#id_search_type").value;
    document.getElementById("date-field").style.display = (type === "date") ? "block" : "none";
    document.getElementById("month-field").style.display = (type === "month") ? "block" : "none";
  }

  // Appel au chargement de la page
  document.addEventListener("DOMContentLoaded", toggleFields);
  // Réagir quand l’utilisateur change le select
  document.querySelector("#id_search_type").addEventListener("change", toggleFields);
</script>
<!-- ================= FIN SCRIPT ================= -->

{% endblock %}
