<!-- Héritage du template de base -->
{% extends "base.html" %}

<!-- Bloc principal de contenu -->
{% block content %}
<div class="container mt-4">
  <!-- Titre de la page -->
  <h2>Historique des mises à jour du stock - {{ boisson.nom }}</h2>

  <!-- ================= FORMULAIRE DE RECHERCHE ================= -->
  <!-- Formulaire GET pour filtrer par date ou par mois -->
  <form method="get" class="mb-3 row g-3">
    <!-- Sélecteur pour choisir le type de recherche -->
    <div class="col-auto">
      {{ form.search_type.label_tag }} {{ form.search_type }}
    </div>

    <!-- Champ pour la recherche par date -->
    <div class="col-auto" id="date-field">
      {{ form.date.label_tag }} {{ form.date }}
    </div>

    <!-- Champ pour la recherche par mois -->
    <div class="col-auto" id="month-field">
      {{ form.month.label_tag }} {{ form.month }}
    </div>

    <!-- Boutons de validation et réinitialisation -->
    <div class="col-auto">
      <button type="submit" class="btn btn-primary">Rechercher</button>
      <!-- Bouton de reset : recharge l'URL sans filtre -->
      <a href="{% url 'boissons:historique_stock' boisson.id %}" class="btn btn-secondary">Réinitialiser</a>
    </div>
  </form>
  <!-- ================= FIN FORMULAIRE ================= -->

  <!-- ================= TABLEAU DES HISTORIQUES ================= -->
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Date</th>
        <th>Stock initial</th>
        <th>Stock actuel</th>
        <th>Justification</th>
      </tr>
    </thead>
    <tbody>
      <!-- Boucle sur chaque enregistrement d’historique -->
      {% for h in historiques %}
        <tr>
          <!-- Date de la mise à jour -->
          <td>{{ h.date|date:"d/m/Y H:i" }}</td>
          <!-- Valeur du stock avant modification -->
          <td>{{ h.stock_initial }}</td>
          <!-- Valeur du stock après modification -->
          <td>{{ h.stock_actuel }}</td>
          <!-- Justification : si absente on affiche "Stock correct" -->
          <td>{{ h.justification|default:"Stock correct" }}</td>
        </tr>
      {% empty %}
        <!-- Message si aucun historique -->
        <tr>
          <td colspan="4">Aucun historique trouvé.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  <!-- ================= FIN TABLEAU ================= -->
</div>

<!-- ================= SCRIPT JAVASCRIPT ================= -->
<script>
  // Fonction pour afficher/masquer les champs selon le choix du select
  function toggleFields() {
    let type = document.querySelector("#id_search_type").value;
    // Affiche le champ date si "date" est choisi, sinon cache-le
    document.getElementById("date-field").style.display = (type === "date") ? "block" : "none";
    // Affiche le champ mois si "month" est choisi, sinon cache-le
    document.getElementById("month-field").style.display = (type === "month") ? "block" : "none";
  }

  // Appeler la fonction au chargement de la page
  document.addEventListener("DOMContentLoaded", toggleFields);
  // Réagir quand l’utilisateur change le select
  document.querySelector("#id_search_type").addEventListener("change", toggleFields);
</script>
<!-- ================= FIN SCRIPT ================= -->

{% endblock %}
